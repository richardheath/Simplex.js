(function(){"use strict";function t(t,i,e,n,s){i._events||(i._events={});var r=i._events[e]||(i._events[e]=[]);r.push({callback:n,context:s,sid:t._sid})}function i(t,i,e,n,s){var r,o;if(i){if(o=t._events[i],!o)return;for(r=0;r<o.length;++r)s&&s===o[r].sid?o[r]=!1:e&&n&&e===o[r].callback&&n===o[r].context?o[r]=!1:e&&!n&&e===o[r].callback?o[r]=!1:n&&!e&&n===o[r].context?o[r]=!1:e||n||(o[r]=!1);o=w.compact(o),0===o.length&&delete t._events[i]}else w(t._events).forEach(function(i,o){for(r=0;r<i.length;++r)s&&s===i[r].sid?i[r]=!1:e&&n&&e===i[r].callback&&n===i[r].context?i[r]=!1:e&&!n&&e===i[r].callback?i[r]=!1:n&&!e&&n===i[r].context?i[r]=!1:e||n||(i[r]=!1);i=w.compact(i),0===i.length&&delete t._events[o]})}function e(t,i,e){if(t._events[i]){var n,s=t._events[i],r=-1,o=s.length,a=e[0],h=e[1],c=e[2];switch(e.length){case 0:for(;++r<o;)(n=s[r]).callback.call(n.context);return;case 1:for(;++r<o;)(n=s[r]).callback.call(n.context,a);return;case 2:for(;++r<o;)(n=s[r]).callback.call(n.context,a,h);return;case 3:for(;++r<o;)(n=s[r]).callback.call(n.context,a,h,c);return;default:for(;++r<o;)(n=s[r]).callback.apply(n.context,e);return}}}function n(t,i){t!==i&&(t._attachedTo||(t._attachedTo={}),t._attachedTo[i._sid]=i,i._attachedTo||(i._attachedTo={}),i._attachedTo[t._sid]=t)}function s(t,i,e,n,s){o(i,e,n,s),s&&t.when(s,"update",function(){o(i,e,n,s)}),t.when(e,"change",function(){o(i,e,n,s)})}function r(t,i,e,n,s){a(i,e,n,s),s&&t.when(s,"update",function(){a(i,e,n,s)})}function o(t,i,e,n){var s;s=n?i.select(n.filter,n.sort,n.dir):i.models,t.$el.html(""),w.forEach(s,function(i){var n=new e({item:i});t.append(n)})}function a(t,i,e,n){n&&(n.sort&&(i=w.sortBy(i,n.sort)),n.filter&&(i=w.where(i,n.filter))),t.$el.html(""),w.forEach(i,function(i){var n=new e({item:i});t.append(n)})}function h(t,i){return function(e){i.call(t,e)}}function c(t,i,e,n){t.when(e,"update",function(){i.val(e.get(n))})}function l(t,i,e,n){t.when(e,"update",function(){i.html(e.get(n))})}function u(t,i,e,n,s){t.when(e,"update",function(){i.attr(s,e.get(n))})}var f,d=this;f="undefined"!=typeof exports?exports:d.Simplex={},f.version="0.0.3";var g=[],p=g.slice,v=/^sx-/,m=/^ev-/,y=function(t){return t.replace(/^\s+|\s+$/g,"")},w=d._;"undefined"==typeof require||w||(w=require("lodash"));var _=f.Events={when:function(i,e,s,r){if((w.isString(i)||w.isArray(i))&&(r=s,s=e,e=i,i=this),s){r=r||this,n(this,i);var o=this;return w.isArray(e)?w.forEach(e,function(e){t(o,i,e,s,r)}):t(o,i,e,s,r),this}},once:function(i,e,s,r){if((w.isString(i)||w.isArray(i))&&(r=s,s=e,e=i,i=this),s){r=r||this,n(this,i);var o=function(t,e,n){var s=function(){e.call(this,arguments),r()},r=function(){i.stopListening(t,s,n)};return s},a=this;return w.isArray(e)?w.forEach(e,function(e){t(a,i,e,o(e,s,r),r)}):t(a,i,e,o(e,s,r),r),this}},stopListening:function(t,e,n,s){var r=this;return t||e||n||s?((w.isString(t)||w.isArray(t))&&(s=n,n=e,e=t,t=this),(w.isString(e)||w.isArray(e))===!1&&(s=n,n=e,e=null),(w.isFunction(n)||w.isString(n))===!1&&(s=n,n=null),w.isArray(e)?w.forEach(e,function(e){i(t,e,n,s)}):i(t,e,n,s),this):(this._events={},this._attachedTo&&w(this._attachedTo).forEach(function(t){i(t,null,null,null,r._sid)}),this)},trigger:function(t){if(!this._events)return this;var i=w.rest(arguments,1),n=this;return w.isArray(t)?w.forEach(t,function(t){e(n,t,i)}):e(this,t,i),this}},x=f.Model=function(t){t||(t={}),this.fields&&w.forEach(this.fields,function(i,e){t[e]||(t[e]=i instanceof I&&w.isUndefined(i["default"])===!1?i["default"]:i)}),this._sid=w.uniqueId("s"),this.set(t,{silent:!0}),this.initialize.apply(this,arguments)};w.assign(x.prototype,_),w.assign(x.prototype,{initialize:function(){},get:function(t){if(this.fields&&this.fields[t]){var i=this.fields[t];if(i.parse)return i.parse(this[t]);if(i.escaped===!1)return this[t]}return w.escape(this[t])},set:function(t,i,e){if(null==t)return this;var n,s;"object"==typeof t?(n=t,e=i):(n={})[t]=i;for(s in n)n.hasOwnProperty(s)&&(this[s]=n[s]);return e!==!0&&(this.trigger("update"),this._triggerCollection("change")),this},has:function(t){return this.hasOwnProperty(t)&&null!=this[t]},unset:function(t,i){return this[t]&&this.hasOwnProperty(t)?(delete this[t],i!==!0&&(this.trigger("update"),this._triggerCollection("change")),this):void 0},clear:function(t){var i;for(i in this)this.hasOwnProperty(i)&&delete this[i];return t!==!0&&(this.trigger("update"),this._triggerCollection("change")),this},raw:function(t){return this[t]},escaped:function(t){return w.escape(this[t])},run:function(t,i){var e,n,s,r=t;i=i||{},"string"==typeof t&&(r={},r[t]=i);for(e in r)n=this.commands[e],s={data:this.toObject()},n.command.run(w.assign(s,w.assign(n,r[e])))},toJSON:function(){return JSON.stringify(this.toObject())},toObject:function(){var t,i={};for(t in this)this.hasOwnProperty(t)&&"_sid"!==t&&"_events"!==t&&(i[t]=this[t]);return i},_triggerCollection:function(t){this.collection&&(w.isArray(this.collection)?w.each(this.collection,function(i){i.trigger(t)}):this.collection.trigger(t))}});var b=f.Collection=function(t,i){t&&w.isArray(t)===!1&&(i=t,t=null),i||(i={}),this.Model=i.Model?i.Model:x,this.uniqueId=i.uniqueId||"_sid",i.commands&&(this.commands=i.commands),this.clear(),this.initialize.apply(this,arguments),t&&this.set(t,{silent:!0})};w.assign(b.prototype,_),w.assign(b.prototype,{initialize:function(){},set:function(t,i){if(t){var e=this,n=this.uniqueId;w.isArray(t)?w.forEach(t,function(t){e._addItem(t instanceof x?t:new e.Model(t))}):e._addItem(t instanceof x?t:new this.Model(t)),this.models.sort(function(t,i){return t[n]>i[n]?1:t[n]<i[n]?-1:0}),i!==!0&&this.trigger("change")}},remove:function(t,i){if(!t)return t=this.models,this.clear(),t;var e=[],n=this;return w.isArray(t)?w.forEach(t,function(t){e.push(n._removeItem(t))}):e.push(n._removeItem(t)),i!==!0&&this.trigger("change"),e},clear:function(t){this.length=0,this.models=[],t!==!0&&this.trigger("change")},get:function(t){for(var i,e,n=0,s=this.length-1,r=this.uniqueId;s>=n;)if(i=Math.floor((n+s)/2),e=this.models[i][r],t>e)n=i+1;else if(e>t)s=i-1;else if(t===e)return this.models[i];return null},at:function(t){return t>=this.length?null:this.models[t]},select:function(t,i,e){e=e&&"DESC"===e.toUpperCase()?1:0;var n;return n=i?w.sortBy(this.models,i):this.models,1===e&&n.reverse(),w.isArray(t)?(1===t.length?t.push(n.length-1):t[1]>n.length-1&&(t[1]=n.length-1),n.slice(t[0],t[1]+1)):w.isObject(t)?w.where(n,t):w.isFunction(t)?w.filter(n,t):w.isUndefined(t)||"*"===t?n:[]},run:function(t,i){var e,n,s,r=t;i=i||{},"string"==typeof t&&(r={},r[t]=i);for(e in r)n=this.commands[e],s={data:this.toObject()},n.command.run(w.assign(s,w.assign(n,r[e])))},_addItem:function(t){var i=this.get(t[this.uniqueId]);return i?(i.clear(),void i.set(t.toObject())):(t.collection=this,this.models.push(t),void(this.length+=1))},_removeItem:function(t){var i;i=t instanceof x?t[this.uniqueId]:t;var e=this.get(i),n=this.models.indexOf(e);return this.models.splice(n,1),e}});var E=["forEach","map","difference","findIndex","findLastIndex","first","indexOf","initial","intersection","last","lastIndexOf","rest","union","uniq","contains","countBy","every","filter","find","findLast","forEachRight","groupBy","indexBy","invoke","max","min","pluck","reduce","reduceRight","reject","sample","shuffle","some","sortBy","toArray","where"];w.forEach(E,function(t){b.prototype[t]=function(){var i=p.call(arguments);return i.unshift(this.models),w[t].apply(w,i)}});var O=f.View=function(t){this._sid=w.uniqueId("s"),t||(t={}),w.assign(this,t),this.initialize.apply(this,arguments)};w.assign(O.prototype,_),w.assign(O.prototype,{initialize:function(){},$:function(t){return this.$el.find(t)},renderToRegion:function(t){"#"===this.template.charAt(0)&&(this.template=t.$(this.template).html()),this.trigger("onShow",this),this.onShow&&this.onShow(),this.region=t,this.$el=t.$el,this.$el.html(this.template),this._processDataBindings(),this.trigger("showed",this),this.showed&&this.showed()},renderViewItems:function(t,i){var e,n=this;if(t.attr("sx-region")){var o=t.attr("sx-region");n[o]||(n[o]=new f.Region(t,n.region.$)),e=n[o]}else e=new f.Region(t,n.region.$);var a=n._getSortOrFilterParam(t.attr("sx-items-options")),h=t.html();t.html("");var c={parent:n,template:h},l=a&&a.View?a.View.extend(c):f.View.extend(c);i instanceof f.Collection?s(n,e,i,l,a):r(n,e,i,l,a)},appendToRegion:function(t){this.trigger("onShow",this),this.onShow&&this.onShow(),this.region=t,this.$el=t.$(this.template),t.$el.append(this.$el),this._processDataBindings(!0),this.trigger("showed",this),this.showed&&this.showed()},_processDataBindings:function(){var t=this,i=t.$el.find("*").addBack("*");i=i.not(t.$el.find("[sx-items] *")),w.forEach(i,function(i){var e,n,s,r,o,a,d,g,p=i.attributes.length,y=t.region.$(i);if(y.attr("sx-id")){if(r=y.attr("sx-id"),a=r.split("."),s=t,1===a.length)o=a[0];else{for(g=a.length-1,d=0;g>d;d+=1)s=s[a[d]];o=a[g]}s[o]=y}if(y.attr("sx-region")){if(r=y.attr("sx-region"),a=r.split("."),s=t,1===a.length)o=a[0];else{for(g=a.length-1,d=0;g>d;d+=1)s=s[a[d]];o=a[g]}s[o]=new f.Region(y,t.region.$)}for(n=0;p>n;++n)if(v.test(i.attributes[n].name)){if(e=i.attributes[n].name.substr(3),r=i.attributes[n].value,a=r.split("."),s=t,1===a.length)o=a[0];else{for(g=a.length-1,d=0;g>d;d+=1)s=s[a[d]];o=a[g]}if("id"!==e&&"region"!==e&&void 0!==s)switch(r=s instanceof x?s.get(o):s[o],e){case"value":w.isFunction(r)&&(r=r.call(t)),"INPUT"===i.nodeName?(y.val(r),s instanceof x&&c(t,y,s,o)):(y.html(r),s instanceof x&&l(t,y,s,o));break;case"items":t.renderViewItems(y,r);break;case"items-options":break;default:m.test(e)?y.on(e.substr(3),h(t,r)):(w.isFunction(r)&&(r=r.call(t)),y.attr(e,r),s instanceof x&&u(t,y,s,o,e))}}})},_getSortOrFilterParam:function(t){if(!t)return null;if("item."===t.substr(0,5))return t.substr(5);var i,e,n,s=this,r=t.split(".");if(1===r.length)i=r[0];else{for(e=r.length-1,n=0;e>n;n+=1)s=s[r[n]];i=r[e]}return s&&s[i]?s[i]:null},_close:function(){this.trigger("onClose",this),this.onClose&&this.onClose(),this.trigger("closed",this),this.closed&&this.closed(),this.stopListening()}});var S=f.Region=function(t,i){this._sid=w.uniqueId("s"),this.views=[],this.$=i||$,this.$el=w.isString(t)?this.$(t):t};w.assign(S.prototype,_),w.assign(S.prototype,{show:function(t){this.trigger("onShow",t),this.onShow&&this.onShow(),t.renderToRegion(this),this.views.push(t),this.trigger("showed",t),this.showed&&this.showed()},close:function(t){if(this.trigger("onClose"),this.onClose&&this.onClose(),t)w.isString(t)&&(t=this.get(t)),t._close(),w.remove(this.views,function(i){return i===t});else{for(var i=this.views.length;i>0;)i-=1,this.views[i]._close();this.$el.empty(),this.views=[]}this.trigger("closed"),this.closed&&this.closed()},append:function(t){t.appendToRegion(this),this.views.push(t)},get:function(t){var i,e=this.views,n=e.length;for(i=0;n>i;++i)if(e[i]._sid===t)return e[i];return null}});var I=f.Type=function(t){t||(t={}),t.validation&&w.assign(t.validation,this.constructor.prototype.validation),w.assign(this,t)};w.assign(I.prototype,{escaped:!0,validate:function(t){var i={};return this.validation?(w.forEach(this.validation,function(e,n){var s=e(t);s!==!0&&void 0!==s&&(i[n]=s)}),w.isEmpty(i)===!1?{valid:!1,errors:i}:{valid:!0}):{}}});var T=f.Command=function(t){t||(t={}),t.mode||(t.mode="ajax"),w.assign(this,t)};w.assign(T.prototype,_),w.assign(T.prototype,{run:function(t){var i="POST",e=this.buildArguments(t),n=this,s=this.validate(e);if(s.valid===!1){var r={};return r[this.name]={error:!0,type:"validation",fields:s.errors},void this.errorHandler(r,t)}var o={};o[this.name]=e,$.ajax({type:i,url:this.url,data:JSON.stringify(o),contentType:"application/json",dataType:"json",success:function(i){n.successHandler(i,t)},failure:function(t){n.errorHandler(t)}})},validate:function(t){var i={},e=function(t,e,n){i[t]||(i[t]={}),i[t][e]=n};return w.forEach(this.parameters,function(i,n){var s=t[n];if(i.required&&(w.isUndefined(s)||""===y(s))&&e(n,"required","Required."),i instanceof I){var r=i.validate(s);r.valid===!1&&w.forEach(r.errors,function(t,i){e(n,i,t)})}}),w.isEmpty(i)===!1?{valid:!1,errors:i}:{valid:!0}},buildArguments:function(t){if(!t||!t.data)return{};var i;return i=t.map?t.data instanceof x?this.map(t.data.toObject(),t.map):this.map(t.data,t.map):t.data instanceof x?t.data.toObject():t.data},map:function(t,i){var e,n={};for(e in t)i[e]?n[i[e]]=t[e]:n[e]=t[e];return n},successHandler:function(t,i){i.success&&i.success(t[this.name]),this.parent?this.parent._dispatchEvents(t):this.trigger("success",t[this.name])},errorHandler:function(t,i){i.error&&i.error(t[this.name]),this.parent?this.parent._dispatchEvents(t):this.trigger("error",t[this.name])}});var j=f.Commands=function(t){t||(t={}),t.mode||(t.mode="ajax"),w.assign(this,t);var i={parent:this,url:this.url,mode:t.mode};t.successHandler&&(i.successHandler=t.successHandler),t.errorHandler&&(i.errorHandler=t.errorHandler),this.Command=T.extend(i)};w.assign(j.prototype,_),w.assign(j.prototype,{add:function(t,i,e){w.isObject(i)&&(e=i,i=null);var n={parameters:e,name:t};i&&(n.url=i),this[t]=new this.Command(n)},remove:function(t){return this[t]&&this.hasOwnProperty(t)?(delete this[t],this):void 0},run:function(t,i){var e,n,s,r,o={},a={};for(e in t)s=t[e],n=this[e],r=n.validate(s.data),r.valid===!1?a[n.name]={error:!0,type:"validation",fields:r.errors}:o[n.name]=n.buildArguments(s);if(w.isEmpty(a)===!1)return void this.errorHandler(a,t,i);var h="POST",c=this;$.ajax({type:h,url:this.url,data:JSON.stringify(o),contentType:"application/json",dataType:"json",success:function(e){c.successHandler(e,t,i)},failure:function(e){c.errorHandler(e,t,i)}})},delayedRun:function(){},_dispatchEvents:function(t){var i,e;for(i in t)this[i]&&this[i]instanceof T!=!1&&(e=t[i].error===!0?"error":"success",this[i].trigger(e,t[i]),this.trigger(e,t[i],i),this.trigger(e+":"+i,t[i]));this.trigger("all"+i,t)},successHandler:function(t,i,e){e.success&&e.success(t);var n;for(n in t)t[n].error===!0?i[n]&&i[n].error&&i[n].error(t[n]):i[n]&&i[n].success&&i[n].success(t[n]);this._dispatchEvents(t)},errorHandler:function(t,i,e){e.error&&e.error(t);var n;for(n in t)i[n]&&i[n].error&&i[n].error(t[n]);this._dispatchEvents(t)}});var A=function(t,i){var e,n=this;e=t&&w.has(t,"constructor")?t.constructor:function(){return n.apply(this,arguments)},w.assign(e,w.assign(n,i));var s=function(){this.constructor=e};return s.prototype=n.prototype,e.prototype=new s,t&&w.assign(e.prototype,t),e.__super__=n.prototype,e};x.extend=b.extend=O.extend=S.extend=T.extend=A,I.extend=function(t,i){return t.validation&&w.assign(t.validation,this.prototype.validation),A.call(this,t,i)}}).call(this);